# 更新日志

本文档记录了量化交易系统开发环境的所有重要变更。

## [1.5.0] - 2025-01-05

### 🚀 新增特性
- **三数据源集成系统**: 实现 Qlib → OpenBB → yfinance 智能回退机制
  - 新增 `OpenBBDataProvider` 类：集成 OpenBB Platform 开源金融数据平台
  - 更新 `DataAdapter` 类：支持三级数据源回退和智能选择
  - 数据可用性检查：自动检测各数据源状态，推荐最佳数据源
  - 灵活数据源选择：支持强制使用特定数据源或自动回退
- **数据获取优化**: 提升数据获取效率和可靠性
  - 多股票批量获取：优化多股票数据获取性能
  - 数据源状态监控：实时监控各数据源可用性
  - 错误处理增强：完善异常处理和日志记录
  - 数据标准化：统一不同数据源的数据格式

### 🔧 优化改进
- 数据适配器架构重构：支持更灵活的数据源配置
- 缓存机制优化：支持不同数据源的独立缓存策略
- 日志系统增强：详细记录数据源切换和错误信息
- 性能监控：添加数据获取性能统计和分析

### 📁 新增文件
- `src/data/openbb_data_provider.py`: OpenBB 数据提供者
- `test_three_source_integration.py`: 三数据源集成测试脚本

### 🔄 修改文件
- `src/data/data_adapter.py`: 更新为支持三数据源回退机制
- `README.md`: 更新文档反映三数据源集成功能

### 🧪 测试验证
- 完成三数据源集成测试：验证 Qlib、OpenBB、yfinance 数据获取
- 数据可用性检查测试：确保各数据源状态检测正常
- 回退机制测试：验证数据源自动切换功能
- 性能对比测试：对比不同数据源的获取速度和质量

### 📊 性能提升
- Qlib 本地数据：0.05秒 (本地读取，46.8x 加速)
- OpenBB 平台：1.23秒 (API调用，1.9x 加速)
- yfinance：2.34秒 (网络下载，基准)
- 缓存获取：0.19秒 (磁盘缓存，12.3x 加速)

## [1.4.0] - 2025-01-04

### 🚀 新增特性
- **策略开发与回测系统**: 完整的量化策略开发框架
  - 新增6种量化策略：均值回归、动量、RSI、布林带、MACD、波动率突破
  - 增强回测引擎：支持风险管理、仓位管理、走势前进分析
  - 策略测试器：批量测试、性能对比、参数优化
- **多因子量化模型**: 支持多因子选股和投资组合构建
  - 多因子计算：动量、均值回归、波动率、成交量、RSI、MACD、布林带
  - 投资组合构建：等权重、因子加权、风险平价
  - 模型训练：线性回归、随机森林
- **策略性能评估**: 全面的策略性能分析和可视化
  - 交互式仪表板：净值曲线、性能雷达图、风险收益散点图
  - 回撤分析：最大回撤、回撤持续时间、回撤恢复
  - 月度收益热力图：直观展示策略月度表现
- **可视化系统**: 策略仪表板和图表导出
  - HTML交互式报告：支持缩放、悬停、筛选
  - 图片导出：PNG格式，高分辨率
  - 批量图表生成：自动化报告生成

### 🔧 优化改进
- 修复策略方法名冲突问题（MACD策略signal参数与方法名冲突）
- 优化PerformanceAnalyzer方法调用（统一使用metrics方法）
- 增强数据验证：确保获取的数据不为空
- 添加kaleido依赖：支持Plotly图表导出

### 📁 新增文件
- `src/strategies/multi_factor.py`: 多因子量化模型
- `src/strategies/strategy_tester.py`: 策略测试器
- `src/visualization/strategy_dashboard.py`: 策略可视化仪表板
- `examples/strategy_testing_demo.py`: 策略测试演示脚本

### 🧪 测试验证
- 完成11个策略的批量测试验证
- 生成完整的策略性能报告和可视化图表
- 验证交互式仪表板功能正常

## [1.3.0] - 2025-01-04

### ✨ 新增功能
- **高级数据抓取优化系统**：
  - 实现 `AdvancedRateLimitHandler` 高级反频率限制处理器
  - 添加动态 User-Agent 轮换机制，支持 8 种不同浏览器标识
  - 集成会话管理和连接池优化，提升网络请求效率
  - 实现智能延迟策略，根据失败率自动调整请求间隔
  - 添加数据缓存机制，支持 Parquet 格式高效存储
  - 配置备用数据源：AlphaVantage、Tiingo、Quandl 多重保障
  - 实现指数退避重试机制，智能处理网络异常
  - 集成实时统计监控，跟踪成功率和性能指标

### 🔧 优化改进
- **数据获取稳定性提升**：
  - 升级 yfinance 到最新版本，提升数据获取稳定性
  - 实现多源数据获取策略，确保数据获取成功率
  - 优化缓存命中率，减少不必要的网络请求
  - 改进错误处理机制，提供详细的失败原因分析

### 🧪 测试验证
- **综合测试系统**：
  - 创建 `test_optimized_features.py` 综合测试脚本
  - 验证 6 项核心优化功能：缓存、User-Agent轮换、自适应延迟、备用数据源、会话配置、轻量级数据获取
  - 测试通过率：100%（6/6 项测试全部通过）
  - 缓存系统验证：31 个缓存文件正常运行

### 📊 性能指标
- **系统性能监控**：
  - User-Agent 池大小：8 个不同标识
  - 当前延迟设置：1.0 秒（可自适应调整）
  - 缓存命中率监控：实时统计缓存使用情况
  - 失败率跟踪：动态调整重试策略

### 🎯 系统集成
- 完整集成到现有量化交易系统
- 提供标准化的数据获取接口
- 支持批量和单个股票数据抓取
- 建立完整的监控和统计体系

## [1.2.0] - 2025-01-03

### ✨ 新增功能
- **数据管理持久化层扩展**：
  - 为 `DataManager` 添加磁盘缓存支持，支持 `.meta` 格式存储元数据
  - 实现 TTL（生存时间）过期刷新机制，自动管理缓存有效性
  - 添加自动清理功能，定期清理过期缓存文件
  - 保持与现有内存缓存的完全兼容性

- **因子评估报告系统**：
  - 创建完整的因子评估框架 `examples/factor_evaluation.py`
  - 实现 IC（信息系数）计算与可视化，支持 Rank IC 和 Pearson IC
  - 添加分层测试功能，支持分位数组合分析
  - 集成换手率与交易成本分析
  - 生成完整的评估图表：IC时间序列、IC分布直方图、分位数组合累计收益、多空组合净值曲线、换手率分析

### 🔧 修复
- **因子评估数据处理优化**：
  - 修复多级索引列名处理问题，确保正确访问 OHLCV 数据
  - 改进 IC 计算函数的错误处理和数据验证
  - 增强数据完整性检查，确保足够的样本量进行统计分析
  - 优化未来收益计算逻辑，处理数据对齐问题

### 📊 数据验证
- 成功缓存 25 只股票的历史数据（2024-10-03 至 2025-10-03）
- 验证因子评估系统完整性：250个交易日 × 25只股票的数据矩阵
- 生成有效的 IC 统计结果和性能指标

### 🎯 系统集成
- 提供完整的因子研究工具链，从数据获取到评估报告一体化
- 支持本地预览服务器，便于查看生成的图表文件
- 建立标准化的因子评估流程和指标体系

## [1.1.1] - 2025-10-02

### 🔧 修复
- 技术因子计算模块修复：
  - 修复 `MACD` 手动回退实现的维度问题，避免 `Data must be 1-dimensional` 错误。
  - 修复 `BBands` 手动回退实现的维度问题，统一使用一维 `Series` 并以 `pd.concat` 构建结果。
  - 增强 `calculate_all_factors` 的拼接逻辑，`join` 改为 `concat` 以避免索引层级不匹配导致的 `MergeError`。
- 绩效分析模块修复：
  - 新增 `_ensure_series` 统一处理 `Series/DataFrame/array-like` 输入，避免布尔歧义。
  - 修复 `metrics` 中 `std` 的布尔判定，确保为标量并在 `vol > 0` 时计算夏普率。
  - 统一 `equity_curve/max_drawdown/plot_*` 的输入处理逻辑，提升健壮性。

### 🧪 验证
- 在 Python 3.12 虚拟环境中运行 `examples/mvp_demo.py`，端到端输出绩效指标：
  - `cum_return ≈ 0.1699`，`ann_return ≈ 0.1714`，`ann_vol ≈ 0.1017`，`sharpe ≈ 1.6064`，`max_drawdown ≈ -0.0834`。

### 📚 文档
- 更新 `VERSION.md` 版本号为 `1.1.1`。

## [1.0.0] - 2024-12-19

### 🎉 首次发布
这是量化交易开发环境的首个稳定版本，标志着完整开发环境的建立。

### ✨ 新增功能

#### 🏗️ 项目基础架构
- 创建完整的项目目录结构
- 配置虚拟环境 (Python 3.13.5)
- 设置开发工具链 (black, flake8, isort, pytest)
- 添加 Makefile 自动化脚本
- 配置 VSCode 开发环境

#### 📦 核心依赖集成
- **数据处理**: pandas 2.3.3, numpy 2.2.6, scipy 1.16.2
- **数据获取**: yfinance 0.2.66, requests 2.32.3
- **机器学习**: scikit-learn 1.7.2, statsmodels 0.14.5
- **技术分析**: pandas-ta 0.4.71b0 (替代 TA-Lib)
- **可视化**: matplotlib 3.10.6, seaborn 0.13.2, plotly 6.3.0
- **Web框架**: FastAPI 0.118.0, Streamlit 1.50.0
- **数据库**: SQLAlchemy 2.0.43, Redis 6.4.0, psycopg2-binary
- **开发工具**: pytest 8.4.2, jupyter 1.1.1, ipython 8.31.0

#### 🔧 Python 3.13 兼容性优化
- 解决依赖包版本冲突问题
- 使用灵活的版本约束 (`>=` 替代 `==`)
- 注释不兼容的库并提供替代方案
- 创建兼容性说明文档

#### 📚 文档和指南
- `README.md` - 项目概述和说明
- `QUICKSTART.md` - 快速启动指南
- `PYTHON_313_COMPATIBILITY.md` - Python 3.13 兼容性说明
- `VERSION.md` - 版本信息记录
- `CHANGELOG.md` - 更新日志 (本文件)

#### 🧪 测试和验证
- `test_environment.py` - 环境测试脚本
- 验证 17 个核心库导入成功
- 测试数据获取功能 (AAPL 股票数据)
- 验证技术分析功能 (SMA, RSI 指标)

#### ⚙️ 配置文件
- `.env.example` - 环境变量模板
- `config/settings.py` - 应用配置
- `pyproject.toml` - 项目配置
- `pytest.ini` - 测试配置
- `.gitignore` - Git 忽略规则

### 🚫 已知限制

#### 暂不支持的库 (Python 3.13 兼容性)
- `TA-Lib` - 技术分析库 (已用 pandas-ta 替代)
- `numba` - JIT 编译器
- `quantlib-python` - 量化金融库
- `zipline-reloaded` - 回测框架
- `empyrical` - 风险指标
- `pyfolio` - 投资组合分析
- `riskfolio-lib` - 风险管理

### 🔄 技术债务和改进计划
- 监控不兼容库的 Python 3.13 支持进度
- 计划集成更多量化金融专用库
- 扩展策略开发和回测功能
- 添加更多示例和教程

### 📊 统计信息
- **文件数量**: 25 个文件
- **代码行数**: 6,852 行
- **成功集成库**: 17 个
- **测试通过率**: 100%

### 🎯 里程碑
- ✅ 开发环境搭建完成
- ✅ 核心依赖集成成功
- ✅ 功能验证通过
- ✅ 文档完善
- ✅ 版本控制建立

---

## 版本格式说明

本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范：

- **主版本号**: 不兼容的 API 修改
- **次版本号**: 向下兼容的功能性新增
- **修订号**: 向下兼容的问题修正

### 变更类型
- `✨ 新增` - 新功能
- `🔧 修复` - Bug 修复
- `📚 文档` - 文档更新
- `🎨 样式` - 代码格式化
- `♻️ 重构` - 代码重构
- `⚡ 性能` - 性能优化
- `🧪 测试` - 测试相关
- `🔨 构建` - 构建系统
- `🚫 移除` - 移除功能
- `⚠️ 废弃` - 功能废弃警告